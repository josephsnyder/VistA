function(WriteXINDEXResult PACKAGE_NAME OUTPUT EXCEPTION_DIR vendername)
   set(FAILURE_CONDITION "F -")

   set(test_passed TRUE)
   foreach (line ${OUTPUT})
      # the XINDEX will always check the integrity of the routine using checksum
      if(line MATCHES "^[A-Z0-9][^ ]+ +\\* \\* .*[cC]hecksum:.*")
        string(REGEX MATCH "^[A-Z0-9]+[^ ]" routine_name "${line}")
      elseif(line MATCHES ${FAILURE_CONDITION})
        # also assume the file name is ${PACKAGE_NAME}.${routinename}
        set(ExceptionFound FALSE)
        if (EXISTS ${EXCEPTION_DIR}/${VENDER_NAME}.${routine_name})
          file(STRINGS ${EXCEPTION_DIR}/${PACKAGE_NAME}.${routine_name} ExceptionList)
          foreach (Exception ${ExceptionList})
            string(STRIP "${line}" newline)
            # this is quite stricty to ensure the text is the exactly the same
            if ("${Exception}" STREQUAL "${newline}")
              set(ExceptionFound TRUE)
              break()
            endif()
          endforeach()
        endif()
        if (NOT ExceptionFound)
          string(REPLACE "F -" ":F -" line ${line})
          file(APPEND @VISTA_BINARY_DIR@/Testing/Log/ErrorOutput.txt "${PACKAGE_NAME}:${routine_name}:${line}\n")
          set(test_passed FALSE)
        endif()
      endif()
   endforeach()
endfunction()


file(REMOVE "@VISTA_BINARY_DIR@/Testing/Log/ErrorOutput.txt")

file(WRITE @VISTA_BINARY_DIR@/Testing/Log/ErrorOutput.txt "PACKAGE NAME:ROUTINE NAME:OFFSET:ERROR CODE\n")
file(GLOB PACKAGES "@XINDEX_LOG_DIRECTORY@/*.log")
foreach(package ${PACKAGES})
    get_filename_component(package_name ${package} NAME_WE)
    string(REPLACE "Test" "" package_name ${package_name})
    if(${package_name} STREQUAL "Last")
      message("Skipping Non-XINDEX file")
    else()
      file(STRINGS "${package}" OUTPUT)
      string(REPLACE "[" "{" OUTPUT "${OUTPUT}" )
      string(REPLACE "]" "}" OUTPUT "${OUTPUT}" )
      WriteXINDEXResult(${package_name} "${OUTPUT}" @VISTA_SOURCE_DIR@/Packages/${package_name} @VENDER_NAME@)
    endif()
endforeach()